<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="nanoit.kr.repository.ReceiveMessageRepository">

    <!--   default setting   -->

    <update id="createReceiveTable">
        CREATE TABLE IF NOT EXISTS "receive"
        (
            "id"               BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
            "result"           varchar(32)                                         NOT NULL,
            "created_at"       timestamptz                                         NOT NULL,
            "last_modified_at" timestamptz                                         NOT NULL
        );
    </update>

    <update id="createResultTable">
        CREATE TABLE IF NOT EXISTS "receive_message_result"
        (
            "result" varchar(32) UNIQUE NOT NULL
        );
    </update>

    <update id="foreignKeySet">
        ALTER TABLE "receive"
            ADD FOREIGN KEY ("result") REFERENCES "receive_message_result" ("result");
    </update>

    <insert id="receive_insertResult">
        INSERT INTO "receive_message_result" (result)
        VALUES ('SUCCESS'),
               ('FAILED')
        ON CONFLICT (result)
            DO NOTHING;
    </insert>

    <!--   default setting end -->

    <select id="receive_count" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM receive;
    </select>

    <select id="receive_selectById" parameterType="_long" resultType="nanoit.kr.domain.entity.SendAckEntity">
        SELECT id, result, created_at, last_modified_at
        FROM receive
        WHERE id = #{id};
    </select>

    <delete id="receive_deleteById" parameterType="_long">
        DELETE
        from receive
        WHERE id = #{id};
    </delete>

    <delete id="receive_deleteAll">
        DELETE
        FROM receive;
        ALTER TABLE receive
            ALTER COLUMN id
                RESTART WITH 1;

    </delete>

    <select id="receive_selectAll" resultType="nanoit.kr.domain.entity.SendAckEntity">
        SELECT *
        FROM receive;
    </select>

    <insert id="receive_insert" parameterType="nanoit.kr.domain.entity.SendAckEntity">
        INSERT INTO receive (result, created_at, last_modified_at)
        VALUES (#{result}, #{createdAt}, #{lastModifiedAt});
    </insert>

    <select id="receive_ping" resultType="java.lang.Boolean">
        SELECT 1;
    </select>


</mapper>

