<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="nanoit.kr.repository.SendMessageRepository">

    <!--   default setting   -->
    <update id="createSendTable">
        CREATE TABLE IF NOT EXISTS "send"
        (
            "id"               BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
            "status"           varchar(16),
            "phone_num"        varchar(32)                                         NOT NULL,
            "callback"         varchar(32)                                         NOT NULL,
            "name"             varchar(64)                                         NOT NULL,
            "content"          varchar(255)                                        NOT NULL,
            "created_at"       timestamptz                                         NOT NULL,
            "last_modified_at" timestamptz                                         NOT NULL
        );
    </update>
    <!--   default setting   -->

    <select id="send_count" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM send;
    </select>

    <delete id="send_deleteAll">
        DELETE
        FROM send;
        ALTER TABLE send
            ALTER COLUMN id
                RESTART WITH 1;
    </delete>

    <delete id="send_deleteById" parameterType="_long">
        DELETE
        FROM send
        WHERE id = #{id};
    </delete>

    <update id="send_updateMessageStatus" parameterType="nanoit.kr.domain.entity.SendEntity">
        UPDATE send
        SET status = #{status}
        WHERE id = #{id};
    </update>

    <select id="send_selectById" parameterType="_long" resultType="nanoit.kr.domain.entity.SendEntity">
        SELECT *
        FROM send
        WHERE id = #{id};
    </select>

    <select id="send_selectAll" resultType="nanoit.kr.domain.entity.SendEntity">
        SELECT *
        FROM send;
    </select>

    <select id="test" parameterType="_long" resultType="nanoit.kr.domain.entity.SendEntity">
        SELECT *
        FROM send
        WHERE id > #{id}
          AND status IS NULL;
    </select>

    <insert id="send_insert" parameterType="nanoit.kr.domain.entity.SendEntity">
        INSERT INTO send (phone_num, callback, name, content, created_at, last_modified_at)
        VALUES (#{phoneNum}, #{callback}, #{name}, #{content}, #{createdAt}, #{lastModifiedAt});
    </insert>

    <select id="send_ping" resultType="java.lang.Boolean">
        SELECT 1;
    </select>


</mapper>

